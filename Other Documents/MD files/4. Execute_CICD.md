## **1.	Before executing Github Actions, ensure that you have checked out the repository and carefully reviewed the *env and modules directories*, including their configuration files, as well as the provided script and SQL file in the *Other Documents* directory. Doing so will make it easier to understand the overall flow of the Terraform configuration.**

-   
    <div align="left">
    <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/Directory_4.png?raw=true" alt="Execute"style="width: 30%; height: auto;">
    </div>

## **2.	Check out and review the Github Actions Workflow directory and its content. The directory is called .github/workflows/.**
-   
    <div align="left">
    <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/Directory_3.png?raw=true" alt="Execute"style="width: 20%; height: auto;">
    </div>    

-   **master.yml** - manually manages the main branch pipeline and integrates all stages like check.yml and deploy.yml using workflow_dispatch. This feature allows users to run a workflow on demand directly from the GitHub Actions dashboard. For example, a workflow may require selecting an input such as the **target environment (dev or prod)** before execution. This provides flexibility for operators to control when and how specific CI/CD pipelines are executed, outside of automatic triggers like push or pull_request events.
-  **check.yml** - checks the format and validate terraform configuration.
-  **deploy.yml** - terraform provisions aws infrastructure securely using AWS using OIDC authentication.
-  **destroy.yml** - decommission the aws infrastructure built by deploy.yml safely that was previously provisioned with Terraform. It is manually triggered using workflow_dispatch to ensure that destructive actions are performed only with explicit approval. This workflow runs the terraform destroy command against the specified **environment (dev or prod)**, removing all associated resources in a controlled manner.

## **3.	Execute Github Actions workflows.**
-	In your repository, you could find the ***Actions***.

    <div align="left">
    <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/Actions_1.png?raw=true" alt="Execute"style="width: 40%; height: auto;">
    </div>   

-   Inside Actions, the Github Actions Workflows is displayed:
    
    <div align="left">
    <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/Actions_2.png?raw=true" alt="Execute"style="width: 20%; height: auto;">
    </div>   

-   To get started, select **Master**.

    <div align="left">
    <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/Actions_4.png?raw=true" alt="Execute"style="width: 20%; height: auto;">
    </div>   

-   Select desired target environment to execute.

    <div align="left">
    <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/Actions_5.png?raw=true" alt="Execute"style="width: 60%; height: auto;">
    </div>   

-   Workflow in progress.


    <div align="left">
    <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/Actions_6.png?raw=true" alt="Execute"style="width: 60%; height: auto;">
    </div>   

    <div align="left">
    <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/Actions_7.png?raw=true" alt="Execute"style="width: 60%; height: auto;">
    </div>   

-   You could view the progress in real time by clicking **Terraform Lint & Validate** and **Terraform Plan & Apply**. In our case, I select the latter.

    <div align="left">
    <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/Actions_8.png?raw=true" alt="Execute"style="width: 60%; height: auto;">
    </div>   

-   To view the AWS infrastructure progress, select the dropdown of **Terraform Apply (Auto Approve)**. This will display the progress of the Terraform actions.

    <div align="left">
    <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/Actions_9.png?raw=true" alt="Execute"style="width: 60%; height: auto;">
    </div>   

-   After **Terraform Apply (Auto Approve)** is done, it shows the output values needed to progress in testing and exploring the project.
-   Image below shows the example terraform output of dev and prod environment. **Take notes of the data provided**:
    -   ### **dev** ###

    <div align="left">
    <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/Actions_10.png?raw=true" alt="Execute"style="width: 40%; height: auto;">
    </div>   

    -   ### **prod** ###

    <div align="left">
    <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/Actions_11.png?raw=true" alt="Execute"style="width: 40%; height: auto;">
    </div>   

## **4.	Explore and test aws infrastructure set up in the dev and prod environment.**
-   ### **dev** ###
    -   Connect to the WebApp instance (EC2) using a session established by the AWS SSM Agent from local computer. Make use of the **web-app-public-id** value from dev output.

        ```bash
        aws ssm start-session --target i-0159529b96f408c35 --region us-west-2
        ```
        <div align="left">
        <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/dev_explore_1.png?raw=true" alt="Execute"style="width: 40%; height: auto;">
        </div>  

    -   Validate the configuration by connecting to the RDS instance and verifying that the expected data has been populated. This step confirms both the infrastructure setup and the application’s interaction with the database.
        -   Check the **rds_endpoint** value fromt the output.

        ```bash
        mysql -u admin -p -h projectdb.1234567889.us-west-2.rds.amazonaws.com
        ```

        <div align="left">
        <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/dev_explore_2.png?raw=true" alt="Execute"style="width: 40%; height: auto;">
        </div>   

        -   This command asked for db password. Type password.

    -   Explore RDS. Verify if the expected data populate.
      
        ```bash
        show databases;
        ```
        <div align="left">
        <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/dev_explore_3.png?raw=true" alt="Execute"style="width: 20%; height: auto;">
        </div>  

    -   Select the database we created.
      
        ```bash
        use myappdb;
        ```
        <div align="left">
        <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/dev_explore_4.png?raw=true" alt="Execute"style="width: 40%; height: auto;">
        </div>  

    -   Verify tables.
      
        ```bash
        show tables;
        ```
        <div align="left">
        <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/dev_explore_5.png?raw=true" alt="Execute"style="width: 20%; height: auto;">
        </div>  

    -   Review ec2_instances table content.
      
        ```bash
        select * from ec2_instances;
        ```
        <div align="left">
        <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/dev_explore_6.png?raw=true" alt="Execute"style="width: 40%; height: auto;">
        </div>  

        -   The data should be the same value as the terrafom output.

    -   Review employees table content.

        ```bash
        select * from employees;
        ```
        <div align="left">
        <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/dev_explore_7.png?raw=true" alt="Execute"style="width: 30%; height: auto;">
        </div>  

        -   The data should be identical from employees.sql in the **Other Documents** directory.

    -   Once done exploring RDS, we could exit by executing this code:

        ```bash
        exit
        ```
        <div align="left">
        <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/dev_explore_8.png?raw=true" alt="Execute"style="width: 15%; height: auto;">
        </div>  

    -   To verify HTML website, copy the Public IP of the WebApp instance and paste it into your browser’s address bar. The simple HTML file will load, showing the Instance ID and the Private IP of the instance. This verifies that the web application is up and running as expected.

        <div align="left">
        <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/dev_explore_9.png?raw=true" alt="Execute"style="width: 60%; height: auto;">
        </div>  

-   ### **prod** ###
    -   Once the infrastructure is deployed, check the Auto Scaling Group instance IDs and their IP addresses. These details cannot be retrieved through Terraform output, since the instances are dynamically created and managed by the Auto Scaling Group. Instead, we will retrive them using AWS cli.
        -   ```bash
            aws ec2 describe-instances --region <REGION> --instance-ids $(aws autoscaling describe-auto-scaling-groups --region <REGION> --auto-scaling-group-names <ASG-NAME> --query "AutoScalingGroups[].Instances[].InstanceId" --output text) --query "Reservations[].Instances[].{ID:InstanceId,PrivateIP:PrivateIpAddress}" --output table
            ```
        -   <div align="left">
            <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/prod_explore_1.png?raw=true" alt="Execute"style="width: 80%; height: auto;">
            </div>
        -   With these details in hand, we can now proceed to connect to the Bastion Host to continue testing.
    
    -   Connect to the Bastion Host.
        -   ```bash
            ssh -A ubuntu@<Bastion Host public ip>
            ```
        -   <div align="left">
            <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/prod_explore_2.png?raw=true" alt="Execute"style="width: 40%; height: auto;">
            </div>
        -   In this environment, I used ubuntu. If you are using linux2, replace the 'ubuntu' from the code to 'ec2-user'.
    -   Once connected, connect to the preferred instance. Use the private IPs we gathered earlier.
        -   ```bash
            ssh ubuntu@<Instance private ip>
            ```
        -   <div align="left">
            <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/prod_explore_3.png?raw=true" alt="Execute"style="width: 40%; height: auto;">
            </div>
        -   You could review the user data log using this command:
        -   ```bash
            vim /var/log/user_data.log
            ```
        -   Once you are done exploring, you can exit the current instance to the Bastion Host.
        -   ```bash
            exit
            ```
        -   <div align="left">
            <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/prod_explore_4.png?raw=true" alt="Execute"style="width: 20%; height: auto;">
            </div>
        -   Connect to another instance by doing the same procedure again.
    -   On Bastion Host, we can verify database we created and its content in RDS.
        -   Repeat the same procedure as we did in the **dev** environment.
        -   Since we have two instance created by ASG. The **ec2_instances** table should look like the image below.
        -   <div align="left">
            <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/prod_explore_5.png?raw=true" alt="Execute"style="width: 40%; height: auto;">
            </div>
    -   Check the HTML website of the instances using the dns of ALB (Application Load Balancer). Copy the dns of ALB and paste it into your browser’s address bar.
    -   <div align="left">
        <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/prod_explore_6.png?raw=true" alt="Execute"style="width: 60%; height: auto;">
        </div>
        
        -   Keep on refreshing the page until the value of **Instance ID** and **Private IP** change. This verifies that the web application and ALB (Application Load Balancer) is up and running as expected.